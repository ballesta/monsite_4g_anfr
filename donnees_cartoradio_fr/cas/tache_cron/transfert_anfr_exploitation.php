<?php
// Transfère la dernière base importée de Cartoradio vers la base de preproduction.
//
// Tests: anfr.monsite4g.fr/donnees_cartoradio_fr/cas/tache_cron/transfert_anfr_exploitation.php
//

require_once "../../composants/Base_donnees.class.php";
require_once "../../composants/Exporte_departements.class.php";
require_once "Verification_finale.php";

echo  "Vérifie les données des tables antennes et supports puis les transfére en expoitation<br>";
$base_donnees_anfr = new Verification_finale("monsite4g_anfr");
if ($base_donnees_anfr->base_valide)
{
    echo "Base valide, contenant suffisament de données<br>";
    transfert_import_vers_exploitation();
    $base_donnees_exploitation = new Verification_finale("monsite4g_test_etude");
    if ($base_donnees_exploitation->base_valide)
    {
        echo "La base exploitation est valide<br>";
    }
    else
    {
        echo "***Erreur*** La base exploitation n'est pas valide";
    }
}
else
{
    echo "Base invalide, pas de transfert vers base en exploitation";
}

function transfert_import_vers_exploitation()
{
    // Base contenant les nouvelles données à mettre en exploitation
    $e = new Base_donnees("monsite4g_anfr");
    echo "Sauvegarde de la base importée de l'ANFR<br>";
    // Duplication par sauvegarde des données importées
    $nom_backup = $e->dump_tables("departements antennes supports supports_antennes");
    echo "nom_backup=$nom_backup<br>";

    $base_destination = new Base_donnees("monsite4g_test_etude");

    echo  "Transfert (load) $nom_backup<br>";
    // Chargement des données pour mise en exploitation
    $base_destination->load_tables($nom_backup);

}

?>
